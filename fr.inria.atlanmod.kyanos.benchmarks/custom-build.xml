<?eclipse.ant.import ?>
<project basedir="." name="benchmarks">
	<!-- Set the directory for running the benchmarks -->
	<property name="benchmarks.dir" value="c:/benchmarks"/>
	<property name="resources.dir" value="resources"/>
	<property name="tests.dir" value="${benchmarks.dir}/temp"/>
	
	<tstamp> 
		<format property="time.stamp" pattern="yyyyMMddHHmmss"/>
	</tstamp>
	<property name="log.file" value="${benchmarks.dir}/antlog-${time.stamp}.txt"/>
	<mkdir dir="${benchmarks.dir}"/>
	<record name="${log.file}"/>

	<!-- Default JVM arguments for creating test resources -->
	<property name="creator.vmargs" value="-Xmx8g" />
	<!-- Default JVM argument for traversing and querying test resources -->
	<property name="tester.vmargs" value="-Xmx8g" />
	
	<property name="debug.vmargs" value="" />

	<property name="creator.vmargs.value" value="-Dfile.encoding=utf-8 ${creator.vmargs} ${debug.vmargs}" />
	<property name="tester.vmargs.value" value="-Dfile.encoding=utf-8 ${tester.vmargs} ${debug.vmargs}" />
	
	<taskdef resource="net/sf/antcontrib/antcontrib.properties">
	  <classpath>
	    <pathelement location="${basedir}/lib/ant-contrib.jar"/>
	  </classpath>
	</taskdef>
	
	<macrodef name="timestamp.echo">
		<attribute name="message"/>    
		<sequential> 
			<local name="current.time" />
			<tstamp> 
				<format property="current.time" pattern="dd/MM/yyyy HH:mm:ss"/> 
			</tstamp>          
			<echo message="${current.time} @{message}" />
		</sequential>
	</macrodef>
	
	<target name="extract.resources">
		<if>
			<not>
				<available file="${resources.dir}" type="dir"/>
			</not>
			<then>
				<unzip src="${basedir}/resources.zip" dest="${basedir}"/>
			</then>
		</if>
	</target>
	
    <target name="migrate.cdo.file">
    	<basename property="xmi.filename" file="${xmi.file}" suffix="xmi"/>
		<property name="cdo.out" value="${benchmarks.dir}/${xmi.filename}.cdo.zxmi"/>
    	<if>
			<not>
				<available file="${cdo.out}" />
			</not>
    		<then>
    			<echo>Creating ${cdo.out}</echo>
    			<echo>JVM args: ${creator.vmargs.value}</echo>
    			<stopwatch name="timer"/>
		        <java classname="fr.inria.atlanmod.kyanos.benchmarks.Migrator" failonerror="true" fork="yes">
		        	<jvmarg line="${creator.vmargs.value}"/>
		            <arg value="-input"/>
		            <arg value="${xmi.file}"/>
		            <arg value="-output"/>
		            <arg value="${cdo.out}"/>
		        	<arg value="-input_epackage_class"/>
		        	<arg value ="org.eclipse.gmt.modisco.java.emf.impl.JavaPackageImpl"/>
		        	<arg value="-output_epackage_class"/>
		        	<arg value="org.eclipse.gmt.modisco.java.cdo.impl.JavaPackageImpl"/>
		            <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
		        </java>
    			<stopwatch name="timer" action="total"/>
			</then>
    		<else>
    			<echo>${cdo.out} already exists</echo>
    		</else>
    	</if>
    </target>
	
    <target name="migrate.kyanos.file">
    	<basename property="xmi.filename" file="${xmi.file}" suffix="xmi"/>
		<property name="kyanos.out" value="${benchmarks.dir}/${xmi.filename}.kyanos.zxmi"/>
    	<if>
			<not>
				<available file="${kyanos.out}" />
			</not>
    		<then>
    			<echo>Creating ${kyanos.out}</echo>
    			<echo>JVM args: ${creator.vmargs.value}</echo>
    			<stopwatch name="timer"/>
		        <java classname="fr.inria.atlanmod.kyanos.benchmarks.Migrator" failonerror="true" fork="yes">
		        	<jvmarg line="${creator.vmargs.value}"/>
		            <arg value="-input"/>
		            <arg value="${xmi.file}"/>
		            <arg value="-output"/>
		            <arg value="${kyanos.out}"/>
		        	<arg value="-input_epackage_class"/>
		        	<arg value ="org.eclipse.gmt.modisco.java.emf.impl.JavaPackageImpl"/>
		        	<arg value="-output_epackage_class"/>
		        	<arg value="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
		            <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
		        </java>
    			<stopwatch name="timer" action="total"/>
			</then>
    		<else>
    			<echo>${kyanos.out} already exists</echo>
    		</else>
    	</if>
    </target>

	<target name="migrate.cdo" depends="extract.resources">
		<foreach inheritall="true" target="migrate.cdo.file" param="xmi.file">
			<path>
				<fileset dir="${resources.dir}">
					<include name="**/*.xmi"/>
				</fileset>
			</path>
		</foreach>
	</target>
	
	<target name="migrate.kyanos" depends="extract.resources">
		<foreach inheritall="true" target="migrate.kyanos.file" param="xmi.file">
			<path>
				<fileset dir="${resources.dir}">
					<include name="**/*.xmi"/>
				</fileset>
			</path>
		</foreach>
	</target>
	
	<target name="migrate.all" depends="extract.resources">
		<antcall target="migrate.cdo" />
		<antcall target="migrate.kyanos" />
	</target>
	
    <target name="gen.test.resource.cdo">
    	<basename property="cdo.zxmi.filename" file="${cdo.zxmi.file}" suffix="cdo.zxmi"/>
		<property name="resource.out" value="${benchmarks.dir}/${cdo.zxmi.filename}.cdoresource"/>
    	<if>
			<not>
				<available file="${resource.out}" />
			</not>
    		<then>
    			<timestamp.echo message="Start" />
    			<echo>Creating ${resource.out}</echo>
    			<echo>JVM args: ${creator.vmargs.value}</echo>
    			<stopwatch name="timer"/>
		        <java classname="fr.inria.atlanmod.kyanos.benchmarks.CdoCreator" failonerror="true" fork="yes">
		        	<jvmarg line="${creator.vmargs.value}"/>
		            <arg value="-input"/>
		            <arg value="${cdo.zxmi.file}"/>
		            <arg value="-output"/>
		            <arg value="${resource.out}"/>
		        	<arg value="-epackage_class"/>
		        	<arg value ="org.eclipse.gmt.modisco.java.cdo.impl.JavaPackageImpl"/>
		        	<arg value="-reponame"/>
		        	<arg value="repo"/>
		            <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
		        </java>
    			<stopwatch name="timer" action="total"/>
    			<timestamp.echo message="End" />
			</then>
    		<else>
    			<echo>${resource.out} already exists</echo>
    		</else>
    	</if>
    </target>
	
    <target name="gen.test.resource.kyanos">
    	<basename property="kyanos.zxmi.filename" file="${kyanos.zxmi.file}" suffix="kyanos.zxmi"/>
		<property name="resource.out" value="${benchmarks.dir}/${kyanos.zxmi.filename}.kyanosresource"/>
		<property name="resource.properties.out" value="${benchmarks.dir}/${kyanos.zxmi.filename}.kyanosresource.properties"/>
    	<if>
			<not>
				<available file="${resource.out}" />
			</not>
    		<then>
    			<!-- Modify Kyanos resource load/save properties here -->
    			<propertyfile file="${resource.properties.out}">
    			  <entry key="blueprints.graph" value="com.tinkerpop.blueprints.impls.neo4j.Neo4jGraph"/>
    			</propertyfile>
    			<timestamp.echo message="Start" />
    			<echo>Creating ${resource.out}</echo>
    			<echo>JVM args: ${creator.vmargs.value}</echo>
    			<stopwatch name="timer"/>
		        <java classname="fr.inria.atlanmod.kyanos.benchmarks.KyanosCreator" failonerror="true" fork="yes">
		        	<jvmarg line="${creator.vmargs.value}"/>
		            <arg value="-input"/>
		            <arg value="${kyanos.zxmi.file}"/>
		            <arg value="-output"/>
		            <arg value="${resource.out}"/>
		        	<arg value="-epackage_class"/>
		        	<arg value ="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
		        	<arg value="-options_file"/>
		        	<arg value="${resource.properties.out}"/>
		            <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
		        </java>
    			<stopwatch name="timer" action="total"/>
    			<timestamp.echo message="End" />
			</then>
    		<else>
    			<echo>${resource.out} already exists</echo>
    		</else>
    	</if>
    </target>
	
    <target name="gen.test.resource.kyanos.map">
    	<basename property="kyanos.zxmi.filename" file="${kyanos.zxmi.file}" suffix="kyanos.zxmi"/>
		<property name="resource.out" value="${benchmarks.dir}/${kyanos.zxmi.filename}.kyanosmapresource"/>
    	<if>
			<not>
				<available file="${resource.out}" />
			</not>
    		<then>
    			<timestamp.echo message="Start" />
    			<echo>Creating ${resource.out}</echo>
    			<echo>JVM args: ${creator.vmargs.value}</echo>
    			<stopwatch name="timer"/>
		        <java classname="fr.inria.atlanmod.kyanos.benchmarks.KyanosMapCreator" failonerror="true" fork="yes">
		        	<jvmarg line="${creator.vmargs.value}"/>
		            <arg value="-input"/>
		            <arg value="${kyanos.zxmi.file}"/>
		            <arg value="-output"/>
		            <arg value="${resource.out}"/>
		        	<arg value="-epackage_class"/>
		        	<arg value ="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
		            <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
		        </java>
    			<stopwatch name="timer" action="total"/>
    			<timestamp.echo message="End" />
			</then>
    		<else>
    			<echo>${resource.out} already exists</echo>
    		</else>
    	</if>
    </target>
	
	<target name="gen.test.resources.cdo">
		<foreach inheritall="true" target="gen.test.resource.cdo" param="cdo.zxmi.file">
			<path>
				<fileset dir="${benchmarks.dir}">
					<include name="**/*.cdo.zxmi"/>
				</fileset>
			</path>
		</foreach>
	</target>
	
	<target name="gen.test.resources.kyanos">
		<foreach inheritall="true" target="gen.test.resource.kyanos" param="kyanos.zxmi.file">
			<path>
				<fileset dir="${benchmarks.dir}">
					<include name="**/*.kyanos.zxmi"/>
				</fileset>
			</path>
		</foreach>
	</target>
	
	<target name="gen.test.resources.kyanos.map">
		<foreach inheritall="true" target="gen.test.resource.kyanos.map" param="kyanos.zxmi.file">
			<path>
				<fileset dir="${benchmarks.dir}">
					<include name="**/*.kyanos.zxmi"/>
				</fileset>
			</path>
		</foreach>
	</target>
	
	<target name="gen.test.resources.all">
		<antcall target="gen.test.resources.cdo" />
		<antcall target="gen.test.resources.kyanos" />
		<antcall target="gen.test.resources.kyanos.map" />
	</target>
	
	<target name="prepare.test.resources.cdo">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.cdoresource/**"/>
			</fileset>
		</copy>
	</target>
	
	<target name="prepare.test.resources.kyanos">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.kyanosresource/**"/>
			</fileset>
		</copy>
	</target>
	
	<target name="prepare.test.resources.kyanos.map">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.kyanosmapresource/**"/>
			</fileset>
		</copy>
	</target>
	
    <target name="traverse.resource.cdo">
		<timestamp.echo message="Start" />
		<echo>Traversing ${cdoresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.CdoTraverser" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${cdoresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.cdo.impl.JavaPackageImpl"/>
	    	<arg value="-reponame"/>
	    	<arg value="repo"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
    <target name="traverse.resource.kyanos">
		<timestamp.echo message="Start" />
		<echo>Traversing ${kyanosresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.KyanosTraverser" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	    	<arg value="-input"/>
	        <arg value="${kyanosresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
    <target name="traverse.resource.kyanos.map">
		<timestamp.echo message="Start" />
		<echo>Traversing ${kyanosresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.KyanosMapTraverser" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${kyanosresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
	<target name="traverse.resources.cdo" depends="migrate.cdo, gen.test.resources.cdo">
		<antcall target="prepare.test.resources.cdo" />
		<foreach inheritall="true" target="traverse.resource.cdo" param="cdoresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.cdoresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
	<target name="traverse.resources.kyanos" depends="migrate.kyanos, gen.test.resources.kyanos">
		<antcall target="prepare.test.resources.kyanos" />
		<foreach inheritall="true" target="traverse.resource.kyanos" param="kyanosresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.kyanosresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
	<target name="traverse.resources.kyanos.map" depends="migrate.kyanos, gen.test.resources.kyanos.map">
		<antcall target="prepare.test.resources.kyanos.map" />
		<foreach inheritall="true" target="traverse.resource.kyanos.map" param="kyanosresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.kyanosmapresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
	<target name="traverse.resources.all" depends="migrate.all, gen.test.resources.all">
		<antcall target="traverse.resources.cdo" />
		<antcall target="traverse.resources.kyanos" />
		<antcall target="traverse.resources.kyanos.map" />
	</target>
	
    <target name="query.list.resource.cdo">
		<timestamp.echo message="Start" />
		<echo>Querying ${cdoresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.CdoQueryList" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${cdoresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.cdo.impl.JavaPackageImpl"/>
	    	<arg value="-reponame"/>
	    	<arg value="repo"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
    <target name="query.list.resource.kyanos">
		<timestamp.echo message="Start" />
		<echo>Querying ${kyanosresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.KyanosQueryList" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${kyanosresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
    <target name="query.list.resource.kyanos.map">
		<timestamp.echo message="Start" />
		<echo>Querying ${kyanosresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.KyanosMapQueryList" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${kyanosresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
	<target name="query.list.resources.cdo" depends="migrate.cdo, gen.test.resources.cdo">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.cdoresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.resource.cdo" param="cdoresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.cdoresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
	<target name="query.list.resources.kyanos" depends="migrate.kyanos, gen.test.resources.kyanos">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.kyanosresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.resource.kyanos" param="kyanosresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.kyanosresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	<target name="query.list.resources.kyanos.map" depends="migrate.kyanos, gen.test.resources.kyanos.map">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.kyanosmapresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.resource.kyanos.map" param="kyanosresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.kyanosmapresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
	<target name="query.list.resources.all" depends="migrate.all, gen.test.resources.all">
		<antcall target="query.list.resources.cdo" />
		<antcall target="query.list.resources.kyanos" />
		<antcall target="query.list.resources.kyanos.map" />
	</target>
	
    <target name="query.loop.resource.cdo">
		<timestamp.echo message="Start" />
		<echo>Querying ${cdoresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.CdoQueryLoop" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${cdoresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.cdo.impl.JavaPackageImpl"/>
	    	<arg value="-reponame"/>
	    	<arg value="repo"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
    <target name="query.loop.resource.kyanos">
		<timestamp.echo message="Start" />
		<echo>Querying ${kyanosresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.KyanosQueryLoop" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${kyanosresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
    <target name="query.loop.resource.kyanos.map">
		<timestamp.echo message="Start" />
		<echo>Querying ${kyanosresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.KyanosMapQueryLoop" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${kyanosresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
	<target name="query.loop.resources.cdo" depends="migrate.cdo, gen.test.resources.cdo">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.cdoresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.resource.cdo" param="cdoresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.cdoresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
	<target name="query.loop.resources.kyanos" depends="migrate.kyanos, gen.test.resources.kyanos">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.kyanosresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.resource.kyanos" param="kyanosresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.kyanosresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	<target name="query.loop.resources.kyanos.map" depends="migrate.kyanos, gen.test.resources.kyanos.map">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.kyanosmapresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.resource.kyanos.map" param="kyanosresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.kyanosmapresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
	<target name="query.loop.resources.all" depends="migrate.all, gen.test.resources.all">
		<antcall target="query.loop.resources.cdo" />
		<antcall target="query.loop.resources.kyanos" />
		<antcall target="query.loop.resources.kyanos.map" />
	</target>
	
</project>