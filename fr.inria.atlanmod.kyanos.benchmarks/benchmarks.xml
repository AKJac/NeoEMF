<?eclipse.ant.import ?>
<project basedir="." name="benchmarks">
	<!-- Set the directory for running the benchmarks -->
	<property name="benchmarks.dir" value="c:/benchmarks"/>
	<property name="resources.dir" value="resources"/>
	<property name="tests.dir" value="${benchmarks.dir}/temp"/>
	
	<tstamp> 
		<format property="time.stamp" pattern="yyyyMMddHHmmss"/>
	</tstamp>
	<property name="log.file" value="${benchmarks.dir}/antlog-${time.stamp}.txt"/>
	<mkdir dir="${benchmarks.dir}"/>
	<record name="${log.file}"/>

	<!-- Default JVM arguments for creating test resources -->
	<property name="creator.vmargs" value="-Xmx8g" />
	<!-- Default JVM argument for traversing and querying test resources -->
	<property name="tester.vmargs" value="-Xmx8g" />
	
	<property name="debug.vmargs" value="" />

	<property name="creator.vmargs.value" value="-Dfile.encoding=utf-8 ${creator.vmargs} ${debug.vmargs}" />
	<property name="tester.vmargs.value" value="-Dfile.encoding=utf-8 ${tester.vmargs} ${debug.vmargs}" />
	
	<taskdef resource="net/sf/antcontrib/antcontrib.properties">
	  <classpath>
	    <pathelement location="${basedir}/lib/ant-contrib.jar"/>
	  </classpath>
	</taskdef>
	
	<macrodef name="timestamp.echo">
		<attribute name="message"/>    
		<sequential> 
			<local name="current.time" />
			<tstamp> 
				<format property="current.time" pattern="dd/MM/yyyy HH:mm:ss"/> 
			</tstamp>          
			<echo message="${current.time} @{message}" />
		</sequential>
	</macrodef>
	
	<target name="extract.resources">
		<if>
			<not>
				<available file="${resources.dir}" type="dir"/>
			</not>
			<then>
				<unzip src="${basedir}/resources.zip" dest="${basedir}"/>
			</then>
		</if>
	</target>
	
    <target name="migrate.cdo.file">
    	<basename property="xmi.filename" file="${xmi.file}" suffix="xmi"/>
		<property name="cdo.out" value="${benchmarks.dir}/${xmi.filename}.cdo.zxmi"/>
    	<if>
			<not>
				<available file="${cdo.out}" />
			</not>
    		<then>
    			<echo>Creating ${cdo.out}</echo>
    			<echo>JVM args: ${creator.vmargs.value}</echo>
    			<stopwatch name="timer"/>
		        <java classname="fr.inria.atlanmod.kyanos.benchmarks.Migrator" failonerror="true" fork="yes">
		        	<jvmarg line="${creator.vmargs.value}"/>
		            <arg value="-input"/>
		            <arg value="${xmi.file}"/>
		            <arg value="-output"/>
		            <arg value="${cdo.out}"/>
		        	<arg value="-input_epackage_class"/>
		        	<arg value ="org.eclipse.gmt.modisco.java.emf.impl.JavaPackageImpl"/>
		        	<arg value="-output_epackage_class"/>
		        	<arg value="org.eclipse.gmt.modisco.java.cdo.impl.JavaPackageImpl"/>
		            <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
		        </java>
    			<stopwatch name="timer" action="total"/>
			</then>
    		<else>
    			<echo>${cdo.out} already exists</echo>
    		</else>
    	</if>
    </target>
	
    <target name="migrate.kyanos.file">
    	<basename property="xmi.filename" file="${xmi.file}" suffix="xmi"/>
		<property name="kyanos.out" value="${benchmarks.dir}/${xmi.filename}.kyanos.zxmi"/>
    	<if>
			<not>
				<available file="${kyanos.out}" />
			</not>
    		<then>
    			<echo>Creating ${kyanos.out}</echo>
    			<echo>JVM args: ${creator.vmargs.value}</echo>
    			<stopwatch name="timer"/>
		        <java classname="fr.inria.atlanmod.kyanos.benchmarks.Migrator" failonerror="true" fork="yes">
		        	<jvmarg line="${creator.vmargs.value}"/>
		            <arg value="-input"/>
		            <arg value="${xmi.file}"/>
		            <arg value="-output"/>
		            <arg value="${kyanos.out}"/>
		        	<arg value="-input_epackage_class"/>
		        	<arg value ="org.eclipse.gmt.modisco.java.emf.impl.JavaPackageImpl"/>
		        	<arg value="-output_epackage_class"/>
		        	<arg value="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
		            <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
		        </java>
    			<stopwatch name="timer" action="total"/>
			</then>
    		<else>
    			<echo>${kyanos.out} already exists</echo>
    		</else>
    	</if>
    </target>

	<target name="migrate.cdo" description="Migrates and initializes the source models into the benchmarks location for CDO" depends="extract.resources">
		<foreach inheritall="true" target="migrate.cdo.file" param="xmi.file">
			<path>
				<fileset dir="${resources.dir}">
					<include name="**/*.xmi"/>
				</fileset>
			</path>
		</foreach>
	</target>
	
	<target name="migrate.kyanos" description="Migrates and initializes the source models into the benchmarks location for Kyanos" depends="extract.resources">
		<foreach inheritall="true" target="migrate.kyanos.file" param="xmi.file">
			<path>
				<fileset dir="${resources.dir}">
					<include name="**/*.xmi"/>
				</fileset>
			</path>
		</foreach>
	</target>
	
    <target name="gen.test.resource.cdo">
    	<basename property="cdo.zxmi.filename" file="${cdo.zxmi.file}" suffix="cdo.zxmi"/>
		<property name="resource.out" value="${benchmarks.dir}/${cdo.zxmi.filename}.cdoresource"/>
    	<if>
			<not>
				<available file="${resource.out}" />
			</not>
    		<then>
    			<timestamp.echo message="Start" />
    			<echo>Creating ${resource.out}</echo>
    			<echo>JVM args: ${creator.vmargs.value}</echo>
    			<stopwatch name="timer"/>
		        <java classname="fr.inria.atlanmod.kyanos.benchmarks.CdoCreator" failonerror="true" fork="yes">
		        	<jvmarg line="${creator.vmargs.value}"/>
		            <arg value="-input"/>
		            <arg value="${cdo.zxmi.file}"/>
		            <arg value="-output"/>
		            <arg value="${resource.out}"/>
		        	<arg value="-epackage_class"/>
		        	<arg value ="org.eclipse.gmt.modisco.java.cdo.impl.JavaPackageImpl"/>
		        	<arg value="-reponame"/>
		        	<arg value="repo"/>
		            <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
		        </java>
    			<stopwatch name="timer" action="total"/>
    			<timestamp.echo message="End" />
			</then>
    		<else>
    			<echo>${resource.out} already exists</echo>
    		</else>
    	</if>
    </target>
	
    <target name="gen.test.resource.kyanos.map">
    	<basename property="kyanos.zxmi.filename" file="${kyanos.zxmi.file}" suffix="kyanos.zxmi"/>
		<property name="resource.out" value="${benchmarks.dir}/${kyanos.zxmi.filename}.kyanosmapresource"/>
    	<if>
			<not>
				<available file="${resource.out}" />
			</not>
    		<then>
    			<timestamp.echo message="Start" />
    			<echo>Creating ${resource.out}</echo>
    			<echo>JVM args: ${creator.vmargs.value}</echo>
    			<stopwatch name="timer"/>
		        <java classname="fr.inria.atlanmod.kyanos.benchmarks.KyanosMapCreator" failonerror="true" fork="yes">
		        	<jvmarg line="${creator.vmargs.value}"/>
		            <arg value="-input"/>
		            <arg value="${kyanos.zxmi.file}"/>
		            <arg value="-output"/>
		            <arg value="${resource.out}"/>
		        	<arg value="-epackage_class"/>
		        	<arg value ="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
		            <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
		        </java>
    			<stopwatch name="timer" action="total"/>
    			<timestamp.echo message="End" />
			</then>
    		<else>
    			<echo>${resource.out} already exists</echo>
    		</else>
    	</if>
    </target>
	
	<target name="gen.test.resources.cdo">
		<foreach inheritall="true" target="gen.test.resource.cdo" param="cdo.zxmi.file">
			<path>
				<fileset dir="${benchmarks.dir}">
					<include name="**/*.cdo.zxmi"/>
				</fileset>
			</path>
		</foreach>
	</target>

	<target name="gen.test.resources.kyanos.map">
		<foreach inheritall="true" target="gen.test.resource.kyanos.map" param="kyanos.zxmi.file">
			<path>
				<fileset dir="${benchmarks.dir}">
					<include name="**/*.kyanos.zxmi"/>
				</fileset>
			</path>
		</foreach>
	</target>
	
	<target name="prepare.test.resources.cdo">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.cdoresource/**"/>
			</fileset>
		</copy>
	</target>
	
	<target name="prepare.test.resources.kyanos.map">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.kyanosmapresource/**"/>
			</fileset>
		</copy>
	</target>
	
    <target name="traverse.resource.cdo">
		<timestamp.echo message="Start" />
		<echo>Traversing ${cdoresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.CdoTraverser" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${cdoresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.cdo.impl.JavaPackageImpl"/>
	    	<arg value="-reponame"/>
	    	<arg value="repo"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
    <target name="traverse.resource.kyanos.map">
		<timestamp.echo message="Start" />
		<echo>Traversing ${kyanosresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.KyanosMapTraverser" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${kyanosresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
	<target name="traverse.resources.cdo" description="Simple model traversal (CDO)" depends="gen.test.resources.cdo">
		<antcall target="prepare.test.resources.cdo" />
		<foreach inheritall="true" target="traverse.resource.cdo" param="cdoresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.cdoresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
	<target name="traverse.resources.kyanos.map" description="Simple model traversal (KyanosMap)" depends="gen.test.resources.kyanos.map">
		<antcall target="prepare.test.resources.kyanos.map" />
		<foreach inheritall="true" target="traverse.resource.kyanos.map" param="kyanosresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.kyanosmapresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
    <target name="query.orphan.resource.cdo">
		<timestamp.echo message="Start" />
		<echo>Querying ${cdoresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.CdoQueryOrphanNonPrimitiveTypes" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${cdoresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.cdo.impl.JavaPackageImpl"/>
	    	<arg value="-reponame"/>
	    	<arg value="repo"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
    <target name="query.orphan.resource.kyanos.map">
		<timestamp.echo message="Start" />
		<echo>Querying ${kyanosresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.KyanosMapQueryOrphanNonPrimitiveTypes" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${kyanosresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
	<target name="query.orphan.resources.cdo" description="Query without full traversal (CDO)" depends="gen.test.resources.cdo">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.cdoresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.orphan.resource.cdo" param="cdoresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.cdoresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
	<target name="query.orphan.resources.kyanos.map" description="Query without full traversal (KyanosMap)" depends="gen.test.resources.kyanos.map">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.kyanosmapresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.orphan.resource.kyanos.map" param="kyanosresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.kyanosmapresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
    <target name="query.grabats.resource.cdo">
		<timestamp.echo message="Start" />
		<echo>Querying ${cdoresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.CdoQueryGrabats" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${cdoresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.cdo.impl.JavaPackageImpl"/>
	    	<arg value="-reponame"/>
	    	<arg value="repo"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
    <target name="query.grabats.resource.kyanos.map">
		<timestamp.echo message="Start" />
		<echo>Querying ${kyanosresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.KyanosMapQueryGrabats" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${kyanosresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
	<target name="query.grabats.resources.cdo" description="Grabats (CDO)" depends="gen.test.resources.cdo">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.cdoresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.grabats.resource.cdo" param="cdoresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.cdoresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
	<target name="query.grabats.resources.kyanos.map" description="Grabats (KyanosMap)" depends="gen.test.resources.kyanos.map">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.kyanosmapresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.grabats.resource.kyanos.map" param="kyanosresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.kyanosmapresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
    <target name="query.unusedmethods.resource.cdo">
		<timestamp.echo message="Start" />
		<echo>Querying ${cdoresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.CdoQueryUnusedMethodsList" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${cdoresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.cdo.impl.JavaPackageImpl"/>
	    	<arg value="-reponame"/>
	    	<arg value="repo"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
    <target name="query.unusedmethods.resource.kyanos.map">
		<timestamp.echo message="Start" />
		<echo>Querying ${kyanosresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.KyanosMapQueryUnusedMethodsList" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${kyanosresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
	<target name="query.unusedmethods.resources.cdo" description="Unused methods (CDO)" depends="gen.test.resources.cdo">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.cdoresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.unusedmethods.resource.cdo" param="cdoresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.cdoresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
	<target name="query.unusedmethods.resources.kyanos.map" description="Unused methods (KyanosMap)" depends="gen.test.resources.kyanos.map">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.kyanosmapresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.unusedmethods.resource.kyanos.map" param="kyanosresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.kyanosmapresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
    <target name="query.thrownexceptions.resource.cdo">
		<timestamp.echo message="Start" />
		<echo>Querying ${cdoresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.CdoQueryThrownExceptionsPerPackage" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${cdoresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.cdo.impl.JavaPackageImpl"/>
	    	<arg value="-reponame"/>
	    	<arg value="repo"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
    <target name="query.thrownexceptions.resource.kyanos.map">
		<timestamp.echo message="Start" />
		<echo>Querying ${kyanosresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.KyanosMapQueryThrownExceptionsPerPackage" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${kyanosresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
	<target name="query.thrownexceptions.resources.cdo" description="Thrown exceptions per package (CDO)" depends="gen.test.resources.cdo">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.cdoresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.thrownexceptions.resource.cdo" param="cdoresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.cdoresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
	<target name="query.thrownexceptions.resources.kyanos.map" description="Thrown exception per package (KyanosMap)" depends="gen.test.resources.kyanos.map">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.kyanosmapresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.thrownexceptions.resource.kyanos.map" param="kyanosresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.kyanosmapresource"/>
				</dirset>
			</path>
		</foreach>
	</target>

    <target name="query.invmethods.resource.cdo">
		<timestamp.echo message="Start" />
		<echo>Querying ${cdoresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.CdoQueryInvisibleMethodDeclarations" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${cdoresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.cdo.impl.JavaPackageImpl"/>
	    	<arg value="-reponame"/>
	    	<arg value="repo"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
    <target name="query.invmethods.resource.kyanos.map">
		<timestamp.echo message="Start" />
		<echo>Querying ${kyanosresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.KyanosMapQueryInvisibleMethodDeclarations" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${kyanosresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
	<target name="query.invmethods.resources.cdo" description="Invisible methods (CDO)" depends="gen.test.resources.cdo">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.cdoresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.invmethods.resource.cdo" param="cdoresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.cdoresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
	<target name="query.invmethods.resources.kyanos.map" description="Invisible methods (KyanosMap)" depends="gen.test.resources.kyanos.map">
			<delete dir="${tests.dir}" failonerror="false"/>
			<mkdir dir="${tests.dir}"/>
			<copy todir="${tests.dir}">
				<fileset dir="${benchmarks.dir}">
					<include name="*.kyanosmapresource/**"/>
				</fileset>
			</copy>
			<foreach inheritall="true" target="query.invmethods.resource.kyanos.map" param="kyanosresource.dir">
				<path>
					<dirset dir="${tests.dir}">
						<include name="**/*.kyanosmapresource"/>
					</dirset>
				</path>
			</foreach>
		</target>
	
	<target name="query.classdecl.resource.cdo">
		<timestamp.echo message="Start" />
		<echo>Querying ${cdoresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.CdoQueryClassDeclarationAttributes" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${cdoresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.cdo.impl.JavaPackageImpl"/>
	    	<arg value="-reponame"/>
	    	<arg value="repo"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
    <target name="query.classdecl.resource.kyanos.map">
		<timestamp.echo message="Start" />
		<echo>Querying ${kyanosresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.KyanosMapQueryClassDeclarationAttributes" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${kyanosresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
	<target name="query.classdecl.resources.cdo" description="Class declaration attributes (CDO)" depends="gen.test.resources.cdo">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.cdoresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.classdecl.resource.cdo" param="cdoresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.cdoresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
	<target name="query.classdecl.resources.kyanos.map" description="Class declaration attributes (KyanosMap)" depends="gen.test.resources.kyanos.map">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.kyanosmapresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.classdecl.resource.kyanos.map" param="kyanosresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.kyanosmapresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
    <target name="query.unusedmethods.complex.resource.cdo">
		<timestamp.echo message="Start" />
		<echo>Querying ${cdoresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.CdoQueryLoop" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${cdoresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.cdo.impl.JavaPackageImpl"/>
	    	<arg value="-reponame"/>
	    	<arg value="repo"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
    <target name="query.unusedmethods.complex.resource.kyanos.map">
		<timestamp.echo message="Start" />
		<echo>Querying ${kyanosresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.KyanosMapQueryLoop" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${kyanosresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
	<target name="query.unusedmethods.complex.resources.cdo" description="Complex query (CDO)" depends="gen.test.resources.cdo">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.cdoresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.unusedmethods.complex.resource.cdo" param="cdoresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.cdoresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
	<target name="query.unusedmethods.complex.resources.kyanos.map" description="Complex query (KyanosMap)" depends="gen.test.resources.kyanos.map">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.kyanosmapresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.unusedmethods.complex.resource.kyanos.map" param="kyanosresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.kyanosmapresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
    <target name="query.rename.resource.cdo">
		<timestamp.echo message="Start" />
		<echo>Querying ${cdoresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.CdoQueryRenameAllMethods" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${cdoresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.cdo.impl.JavaPackageImpl"/>
	    	<arg value="-reponame"/>
	    	<arg value="repo"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
    <target name="query.rename.resource.kyanos.map">
		<timestamp.echo message="Start" />
		<echo>Querying ${kyanosresource.dir}</echo>
		<echo>JVM args: ${tester.vmargs.value}</echo>
		<stopwatch name="timer"/>
	    <java classname="fr.inria.atlanmod.kyanos.benchmarks.KyanosMapQueryRenameAllMethods" failonerror="true" fork="yes">
        	<jvmarg line="${tester.vmargs.value}"/>
	        <arg value="-input"/>
	        <arg value="${kyanosresource.dir}"/>
	    	<arg value="-epackage_class"/>
	    	<arg value ="org.eclipse.gmt.modisco.java.kyanos.impl.JavaPackageImpl"/>
	        <classpath refid="fr.inria.atlanmod.kyanos.benchmarks.classpath"/>
	    </java>
		<stopwatch name="timer" action="total"/>
		<timestamp.echo message="End" />
    </target>
	
	<target name="query.rename.resources.cdo" description="Model modification and saving (CDO)" depends="gen.test.resources.cdo">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.cdoresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.rename.resource.cdo" param="cdoresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.cdoresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
	<target name="query.rename.resources.kyanos.map" description="Model modification and saving (KyanosMap)" depends="gen.test.resources.kyanos.map">
		<delete dir="${tests.dir}" failonerror="false"/>
		<mkdir dir="${tests.dir}"/>
		<copy todir="${tests.dir}">
			<fileset dir="${benchmarks.dir}">
				<include name="*.kyanosmapresource/**"/>
			</fileset>
		</copy>
		<foreach inheritall="true" target="query.rename.resource.kyanos.map" param="kyanosresource.dir">
			<path>
				<dirset dir="${tests.dir}">
					<include name="**/*.kyanosmapresource"/>
				</dirset>
			</path>
		</foreach>
	</target>
	
</project>

